## Processing TECdisplay data using TECdisplay_mapper

`TECdisplay_mapper` coordinates sequencing read processing by `fastp` and maps sequencing reads to targets that were generated by `variant_maker`.  The expected run time is variable depending on the size of the  data set. A TECdisplay data set with a typical sequencing depth (200-300M paired end reads) will typically take 30-60 minutes to process.

**`TECdisplay_mapper` requires that `fastp` (https://github.com/OpenGene/fastp) is installed.**

### TECdisplay_mapper inputs and options

```
-m/--mode <run_mode_specifier>     set run mode (required) using one of following run mode specifiers:
                                   MAP_SEQ_READS  Process and map sequencing reads from a TECdisplay experiment.
                                   MAP_TEST_DATA  Generate and map test data for an input targets file.

-i/--read1 <read_1_fastq_file>     Read 1 FASTQ file input.
                                   Required for MAP_SEQ_READS mode.
                                   Must not be provided in MAP_TEST_DATA mode.

-I/--read2 <read_2_fastq_file>     Read 2 FASTQ file input.
                                   Required for MAP_SEQ_READS mode.
                                   Must not be provided in MAP_TEST_DATA mode.

-t/--targets <targets_file>        Targets file input (required). Targets file must be generated by variant_maker.

-o/--out_name <output_file_name>   Output file name (optional)

-p/--fastp_path <path_to_fastp>    Path to fastp executable (optional). Only needed if fastp was not added to PATH.

-v/--qual-variable <value 0 to 41> Minimum qscore for variable bases (optional). Default is 20.

-c/--qual-constant <value 0 to 41> Minimum qscore for constant bases (optional). Default is 0.
```

### Basic usage of TECdisplay_mapper

If analyzing TECdisplay data, run `TECdisplay_mapper` in `MAP_SEQ_READS` mode:

`TECdisplay_mapper -m MAP_SEQ_READS -i <read1_fastq> -I <read2_fastq> -t <targets>`

If generating and mapping test data, run `TECdisplay_mapper` in `MAP_TEST_DATA` mode:

`TECdisplay_mapper -m MAP_TEST_DATA -t <targets>`

In both `MAP_SEQ_READS` and `MAP_TEST_DATA` mode, the following files/directories will be generated:

- out.txt (or <out_name>_out.txt if -o option was used), which contains the number of reads that mapped to the bound and unbound channels for each variant and the fraction of reads that mapped to the bound channel.
  
- mapping.txt, which contains a list of the input files that were provided and report of read mapping metrics.

- processed, which contains the output fastq files from fastp processing.

- navigator_templates, which contains a constraints file template for use with `TECdisplay_navigator` and `TECdisplay_Hnav`.
  
- fastp_command.txt, which records the fastp command that was used.

- fastp.html/fastp.json, fastp processing metrics.


In `MAP_TEST_DATA` mode, the following additional file and directory will be generated:

- test_data_analysis.txt, test data analysis metrics.

- <targets_file_name>_test_data, which contains the test_data fastq files that were used for the test data analysis. 
